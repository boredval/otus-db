## HW04 DDL скрипты для PostgreSQL

### Создание табличного пространства
````
CREATE TABLESPACE booking_space OWNER postgres LOCATION 'D:\db\booking_space';
````
### Создание базы данных

````
CREATE DATABASE hotel_booking WITH OWNER = postgres ENCODING = 'UTF8' TABLESPACE = booking_space;
````
### Создание ролей developer,qa
````
CREATE ROLE developer LOGIN PASSWORD 'passWord!123';
````
### Предоставление доступов роли developer на подключение
````
GRANT GRANT CONNECT ON DATABASE hotel_booking TO developer;
````
### Создание схемы "booking_app" и предоставление прав для роли developer
````
CREATE SCHEMA IF NOT EXISTS booking_app AUTHORIZATION developer;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA booking_app TO developer;
````
### Создание схемы analysis и предоставление прав для роли developer
````
CREATE SCHEMA IF NOT EXISTS analysis AUTHORIZATION developer;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA analysis TO developer;
````

### Создание типов

````
CREATE TYPE "reservation_status" AS ENUM (
'NEW',
'CONFIRMED',
'CANCELLED'
);

CREATE TYPE "payment_status" AS ENUM (
'PENDING',
'PAID',
'REFUND'
);

CREATE TYPE "payment_method" AS ENUM (
'CASH',
'ONLINE'
);
````

### Создание таблиц

````
CREATE TABLE booking_app."hotel" (
"id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"name" varchar(255) UNIQUE NOT NULL,
"description" longtext,
"rating" decimal,
"country" varchar(255) NOT NULL,
"city" varchar(255) NOT NULL,
"address" varchar(255) UNIQUE NOT NULL,
"phone" varchar(255) UNIQUE NOT NULL,
"email" varchar(255) NOT NULL
);

CREATE TABLE booking_app."hotel_room" (
"id" bigint PRIMARY KEY,
"hotel_id" bigint NOT NULL,
"type" varchar(255) UNIQUE NOT NULL,
"guests" integer NOT NULL,
"price" decimal NOT NULL,
"description" longtext,
"facilities" longtext NOT NULL
);

CREATE TABLE booking_app."reservation" (
"id" bigint PRIMARY KEY,
"user_id" bigint,
"hotel_room_id" bigint,
"check_in_date" datetime,
"check_out_date" datetime,
"num_of_guests" integer,
"status" reservation_status,
"payment_id" bigint,
"promo_id" bigint
);

CREATE TABLE booking_app."user" (
"id" bigint PRIMARY KEY,
"name" varchar(255),
"email" varchar(255),
"phone" varchar(255),
"registration_date" datetime
);

CREATE TABLE booking_app."review" (
"id" bigint PRIMARY KEY,
"user_id" bigint,
"reservation_id" bigint,
"review" longtext,
"review_rate" decimal
);

CREATE TABLE booking_app."promo" (
"id" bigint PRIMARY KEY,
"name" varchar(255),
"description" varchar(255),
"discount" decimal,
"start_date" datetime,
"end_date" datetime,
"condition" varchar(255)
);

CREATE TABLE booking_app."payment" (
"id" bigint PRIMARY KEY,
"price" decimal,
"payment_status" payment_status,
"payment_method" payment_method
);

CREATE TABLE analysis."booking_analysis" (
"id" bigint PRIMARY KEY,
"date" datetime,
"num_of_reservations" integer,
"num_of_guests" integer,
"hotel_id" bigint UNIQUE,
"average_price" decimal,
"revenue" decimal
);

ALTER TABLE booking_app."hotel_room" ADD FOREIGN KEY ("hotel_id") REFERENCES booking_app."hotel" ("id");

ALTER TABLE booking_app."reservation" ADD FOREIGN KEY ("user_id") REFERENCES booking_app."user" ("id");

ALTER TABLE booking_app."reservation" ADD FOREIGN KEY ("hotel_room_id") REFERENCES booking_app."hotel_room" ("id");

ALTER TABLE booking_app."reservation" ADD FOREIGN KEY ("payment_id") REFERENCES booking_app."payment" ("id");

ALTER TABLE booking_app."reservation" ADD FOREIGN KEY ("promo_id") REFERENCES booking_app."promo" ("id");

ALTER TABLE booking_app."user" ADD FOREIGN KEY ("id") REFERENCES booking_app."review" ("user_id");

ALTER TABLE booking_app."reservation" ADD FOREIGN KEY ("id") REFERENCES booking_app."review" ("reservation_id");

ALTER TABLE booking_app."hotel" ADD FOREIGN KEY ("id") REFERENCES analysis."booking_analysis" ("hotel_id");
````