## HW01 Добавление индексов и ограничений

### Схема

![Схема базы данных](/images/booking.png)

### Описание таблиц

#### hotel

Описание: таблица доступных для бронирования гостиниц

| Поле        | Описание                    | Пример                                      | Настройки колонки  |
|-------------|-----------------------------|---------------------------------------------|--------------------|
| id          | Уникальный идентификатор    | 1                                           | PK, Auto-increment |
| name        | Наименование гостиницы      | Raddison                                    | NN, UNIQUE         |
| description | Описание                    | Гостеприимный персонал, спокойная атмосфера |                    |
| rating      | Рейтинг гостиницы           | 4.5                                         | CHECK > 0          |
| country     | Страна                      | Россия                                      | NN                 |
| city        | Город                       | Москва                                      | NN                 |
| address     | Адрес                       | улица Пушкина д.123                         | NN, UNIQUE         |
| phone       | Номер телефона бронирования | +79151112233                                | NN                 |
| email       | Эл. почта                   | myemail@gmail.com                           | NN                 |

#### hotel_room

Описание: таблица доступных номеров в гостинице

| Поле        | Описание                 | Настройки колонки  |
|-------------|--------------------------|--------------------|
| id          | Уникальный идентификатор | PK, Auto-increment |
| hotel_id    | Идентификатор гостиницы  | FK, NN             |
| type        | Тип номера               | NN                 |
| guests      | Кол-во гостей            |                    |
| price       | Цена                     | CHECK > 0.0        |
| description | Описание номера          |                    |
| facilities  | Удобства                 | NN                 |

#### reservation

Описание: таблица бронирований

| Поле           | Описание                   | Настройки колонки  |
|----------------|----------------------------|--------------------|
| id bigint      | Уникальный идентификатор   | PK, Auto-increment |
| user_id        | Идентификатор пользователя | FK, NN             |
| hotel_room_id  | Идентификатор номера       | FK, NN             |
| check_in_date  | Дата заезда                |                    |
| check_out_date | Дата выезда                |                    |
| num_of_guests  | Кол-во гостей              | NN, CHECK > 0      |
| status         | Статус бронирования        | NN                 |
| payment_id     | Идентификатор платежа      | FK, NN             |
| promo_id       | Идентификатор промо-акции  | FK, NN             |

#### user

Описание: таблица пользователей

| Поле              | Описание                 | Настройки колонки  |
|-------------------|--------------------------|--------------------|
| id                | Уникальный идентификатор | PK, Auto-increment |
| name              | ФИО пользователя         | NN                 |
| email             | Адрес эл. почты          | NN                 |
| phone             | Номер телефона           | NN, UNIQUE         |
| registration_date | Дата регистрации         | NN                 |

#### review

Описание: таблица отзывов пользователей

| Поле           | Описание                   | Настройки колонки  |
|----------------|----------------------------|--------------------|
| id             | Уникальный идентификатор   | PK, Auto-increment |
| user_id        | Идентификатор пользователя | FK, NN             |
| reservation_id | Идентификатор бронирования | FK, NN             |
| review         | Текст отзыва               | NN                 |
| review_rate    | Оценка                     | NN , CHECK > 0     |

#### promo

Описание: таблица доступных промо-акций

| Поле        | Описание                 | Настройки колонки  |
|-------------|--------------------------|--------------------|
| id          | Уникальный идентификатор | PK, Auto-increment |
| name        | Название промо-акции     | NN                 |
| description | Описание                 | NN                 |
| discount    | Скидка                   | NN, CHECK > 0      |
| start_date  | Дата начала акции        | NN                 |
| end_date    | Дата завершения акции    | NN                 |
| condition   | Условие получения скидки | NN                 |

#### payment

Описание: таблица с информацией о платеже

| Поле           | Описание                 | Настройки колонки  |
|----------------|--------------------------|--------------------|
| id             | Уникальный идентификатор | PK, Auto-increment |
| price          | Стоимость                | NN, CHECK > 0      |
| payment_status | Статус платежа           | NN                 |
| payment_method | Способ оплаты            | NN                 |

#### booking_analysis

Описание: таблица сбора аналитики по бронированиям

| Поле                | Описание                       | Пример             |
|---------------------|--------------------------------|--------------------|
| id bigint           | Уникальный идентификатор       | PK, Auto-increment |
| date                | Дата сбора аналитики           | NN                 |
| num_of_reservations | Кол-во бронирований            | NN,                |
| num_of_guests       | Кол-во гостей                  | NN                 |
| hotel_id bigint     | Идентификатор гостиницы        | FK, NN             |
| average_price       | Средняя стоимость бронирования | NN, CHECK > 0      |
| revenue             | Выручка                        | NN,CHECK > 0       |

### Запросы

* Поиск гостиниц
    + По названию
    + По рейтингу
    + По локации(страна/город)
* Поиск номеров
    + По типу
    + По вместимости гостей
    + По цене
* Поиск бронирований
    + По номеру в гостинице
    + По статусу
    + По дате заезда/выезда
* Поиск оплаты бронирования
    + По статусу платежа
* Поиск пользователей
    + По имени
    + По email
    + По дате регистрации
* Поиск отзывов
    + По рейтингу отзыва(сначала негативные/сначала положительные)
* Поиск промо-акций
    + По размеру скидки
    + По дате начала/завершения акции
* Поиск аналитики по бронированиям
    + По выручке
    + По кол-ву гостей
    + по кол-во бронирований

### Кардинальность полей

#### Таблица hotel

Поле `name` - высокая кардинальность, значений может быть свыше миллиона
Поле `rating` - низкая кардинальность, значения могут быть от 0 до 5.
Поле `country` - низкая кардинальность, стран в мире 193 по данным из Википедии.

#### Таблица hotel_room

Поле `type` - низкая кардинальность, т.к. вариантов гостиничных номеров немного
Поле `guests` - низкая кардинальность, т.к. кол-во гостей в номере ограничено
Поле `price` - высокая кардинальность, кол-во уникальных цен может быть большое

#### Таблица reservation

Поле `hotel_room_id` - скорее всего низкая кардинальность
Поле `status` - низкая кардинальность, ограничено значениями в enum
Поле `check_in_date` и `check_out_date` - скорее всего высокая кардинальность, т.к. кол-во уникальных дат может быть
большим

#### Таблица payment

Поле `payment_status` - низкая кардинальность, ограничено значениями в enum

#### Таблица user

Поле `name` - скорее всего высокая кардинальность, т.к. кол-во уникальных значений может быть большим
Поле `email` - скорее всего высокая кардинальность, т.к. кол-во уникальных значений может быть большим
Поле `registration_date` - скорее всего высокая кардинальность, т.к. кол-во уникальных дат может быть большим

#### Таблица review

Поле `review_rate` - низкая кардинальность, значения могут быть от 0 до 5.

#### Таблица promo

Поле `discount` - низкая кардинальность, размер скидки может быть от 1 до 100%
Поле `start_date` и `end_date`- скорее всего высокая кардинальность, т.к. кол-во уникальных дат может быть

#### Таблица booking_analysis

Поле `revenue`  - скорее всего высокая кардинальность, т.к. кол-во уникальных значений может быть большим
Поле `num_of_guests` - скорее всего высокая кардинальность, т.к. кол-во уникальных значений может быть большим
Поле `num_of_reservations` - скорее всего высокая кардинальность, т.к. кол-во уникальных значений может быть большим

### Индексы

Исходя из анализа кардинальностей полей, можно добавить индексы на все поля с высокой кардинальностью, но есть нюансы:

+ Думаю, что для поиска по наименованию гостиницы, можно использовать индекс для полнотекстового поиска т.е. gin индекс(
  При условии, что мы завязываемся на СУБД PostgreSQL)
+ Если предполагается, что поиск по датам будет BETWEEN , то рекомендуется добавить индексы на поля с датами, иначе это
  не принесет ожидаемой производительности и лучше индексировать какое-нибудь другое поле или не индексировать вообще.

* Примеры индексов:
    + `hotel_room_price` в таблице `hotel_room`
    + `name`,`email` (композитный индекс) в таблице `user`
