## DML в PostgreSQL

### Вставка данных
```
INSERT INTO hotel (name, city) VALUES ('Hotel', 'Moscow');

INSERT INTO review (review,user_id) VALUES ('good',(SELECT id FROM user WHERE registration_date > 2022-01-01));

INSERT INTO hotel_room (hotel_id,type,price)
VALUES
((SELECT id FROM hotel h WHERE h.name = 'Hotel'),'Single',25.99),
((SELECT id FROM hotel h WHERE h.name = 'Hotel'),'Double',35.99),
((SELECT id FROM hotel h WHERE h.name = 'Hotel'),'Queen',65.99),
((SELECT id FROM hotel h WHERE h.name = 'Hotel'),'King',75.99);
```

### Получение данных

#### Запрос вернет все гостиницы в Москве.
```
SELECT * FROM hotel WHERE city = 'Moscow';
```
#### Вернет наименование гостиницы, тип номера и статус оплаты для бронирования с id = 12
```
SELECT h.name,hr.type,r.status FROM reservation r
LEFT JOIN hotel_room hr ON r.hotel_room_id = hr.id
LEFT JOIN hotel h ON h.id = hr.hotel_id 
WHERE r.id = 12;
```

### Обновление данных

#### Обновит стоимость номера в гостинице где id = 10 и тип номера = 'Queen'
```
UPDATE hotel_room SET price 70.0 WHERE type = 'Queen' and hotel_id = 10;
```

#### Обновление таблицы с аналитическими данными, прибавит к общему числу гостей количество гостей из конкретного бронирования
```
UPDATE booking_analysis ba
SET ba.num_of_guests + r.num_of_guests
FROM reservation r
WHERE r.hotel_id IN (SELECT id FROM hotel h WHERE h.name = 'Hotel');
```

### Удаление данных

#### Запрос удалит все записи из таблицы review
```
DELETE FROM review;
```
#### Запрос удалит запись по дате используя даннык из другой таблицы
```
DELETE FROM booking_analysis ba
USING hotel h
WHERE ba.hotel_id = h.id AND ba.date = 2023-01-01;
```